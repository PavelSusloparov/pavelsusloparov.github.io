<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>JavaScript - React - GraphQL - MongoDb | Pavel Susloparov Personal Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="JavaScript - React - GraphQL - MongoDb" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="React app" />
<meta property="og:description" content="React app" />
<link rel="canonical" href="http://localhost:4000/javascript/graphql/mongodb/2020/05/10/react-graphql-mongodb.html" />
<meta property="og:url" content="http://localhost:4000/javascript/graphql/mongodb/2020/05/10/react-graphql-mongodb.html" />
<meta property="og:site_name" content="Pavel Susloparov Personal Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T21:25:36-04:00" />
<script type="application/ld+json">
{"headline":"JavaScript - React - GraphQL - MongoDb","dateModified":"2020-05-10T21:25:36-04:00","datePublished":"2020-05-10T21:25:36-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/javascript/graphql/mongodb/2020/05/10/react-graphql-mongodb.html"},"description":"React app","@type":"BlogPosting","url":"http://localhost:4000/javascript/graphql/mongodb/2020/05/10/react-graphql-mongodb.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Pavel Susloparov Personal Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Pavel Susloparov Personal Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1 id="react-app">React app</h1>

<p>I wrote a small full-stack sample on JavaScript, which includes</p>
<ul>
  <li>Frontend React based component</li>
  <li>Backend GraphQL based component</li>
  <li>MongoDB for storing the state</li>
</ul>

<p>Source code is here - <a href="https://github.com/PavelSusloparov/friends-registry">https://github.com/PavelSusloparov/friends-registry</a></p>

<p>The app allows you to add a friend by providing a first and last name and shows the list of current friends.</p>

<h2 id="in-depths">In depths</h2>

<h3 id="mongodb">MongoDB</h3>

<p>MongoDB is a non-relational database, which has a fast bootstrap as a docker container and a free client.
Perfect for sample projects, when a document contains all required information.
I like to run sample databases in a docker container by creating a docker-compose configuration,
so it is easy to wipe the data and start from scratch.</p>

<p>Find more information about bootstrap and connection to the database in the repo link above.</p>

<h3 id="server">Server</h3>

<p>GraphQL server is Apollo server - <a href="https://www.apollographql.com/docs/apollo-server/">https://www.apollographql.com/docs/apollo-server/</a>
It positions itself as a gateway to combine multiple APIs and provide a clean interface to the frontend component.
I combined the ORM layer with the Apollo server for the sake and simplicity of the demo project.
In the production project, I recommend creating a separate backend service with the ORM layer and calling the backend service from the gateway component through an interface.</p>

<p>Apollo gateway provides a neat browser console with capabilities to execute GraphQL queries. See the project’s documentation for more details.
The gateway provides three types of interfaces:</p>
<ul>
  <li>Query</li>
  <li>Mutation</li>
  <li>Subscription</li>
</ul>

<p>Queries fetch data; mutations modify data; subscription emits events on data modification with capabilities to react on client-side.</p>

<h3 id="client">Client</h3>

<p>The client is a React-based application, created using create-react-app bootstrap repo and showcase client connection between React and Apollo GraphQL.
When a user adds a new friend, the client makes a GraphQL mutation call for the creation of a new friend.
Since I know the new friend at the moment of the update, I can populate the list of friends with a fake id and refresh the id created by the database on the page refresh.
Also, the client subscribes to new friends creation events during the application bootstrap, which allows updating the friend list modified by another client without refreshing the web page.
Only one way to showcase the subscription functionality is to call GraphQL to create friend mutation through the GraphQL console or insert a new friend into the database with MongoDB client.
In this case, the new friend will appear on the friend’s list without the web page refresh.
I found the Apollo GraphQL client is much easier for understanding and use for simple use cases comparing with the Redux library.</p>

<p>Thank you for reading!</p>



<script defer src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js"></script>
<script defer type="text/javascript" src="http://localhost:4000/assets/js/firebase-init.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", function() {
        var firebasePost = firebase.database().ref('posts/10');
        firebasePost.once('value').then((snapshot) => {
            const data = snapshot.val();
            if (data == null) {
                firebasePost.set({
                    likeCount: 0,
                    dislikeCount: 0,
                    title: 'JavaScript - React - GraphQL - MongoDb',
                });
                document.getElementById("likeCount").innerHTML = 0;
                document.getElementById("dislikeCount").innerHTML = 0;
            } else {
                document.getElementById("likeCount").innerHTML = data["likeCount"];
                document.getElementById("dislikeCount").innerHTML = data["dislikeCount"];
            }
            if (localStorage.getItem("likeCountPressed") == null) {
                localStorage.setItem("likeCountPressed", "0");
            }
            if (localStorage.getItem("dislikeCountPressed") == null) {
                localStorage.setItem("dislikeCountPressed", "0");
            }
        });
    });

    function like() {
        if (localStorage.getItem("likeCountPressed") === "1") {
            unLike()
        } else {
            var firebasePost = firebase.database().ref('posts/10');
            firebasePost.once('value').then((snapshot) => {
                const data = snapshot.val();

                if (data == null) {
                    firebasePost.set({
                        likeCount: 0,
                        dislikeCount: 0,
                        title: 'JavaScript - React - GraphQL - MongoDb',
                    });
                } else {
                    var obj = {};
                    obj["likeCount"] = data["likeCount"] + 1;

                    firebasePost.update(obj, function(error) {
                        if (error) {
                            console.error("Ooops! Something went wrong during like count update");
                        }
                    });
                    document.getElementById("likeCount").innerHTML = data["likeCount"] + 1;
                }
            });
            localStorage.setItem("likeCountPressed", "1");
        }
    }

    function unLike() {
        var firebasePost = firebase.database().ref('posts/10');
        firebasePost.once('value').then((snapshot) => {
            const data = snapshot.val();

            if (data == null) {
                firebasePost.set({
                    likeCount: 0,
                    dislikeCount: 0,
                    title: 'JavaScript - React - GraphQL - MongoDb',
                });
            } else {
                var obj = {};
                obj["likeCount"] = data["likeCount"] - 1;

                firebasePost.update(obj, function(error) {
                    if (error) {
                        console.error("Ooops! Something went wrong during like count update");
                    }
                });
                document.getElementById("likeCount").innerHTML = data["likeCount"] - 1;
            }
        });
        localStorage.setItem("likeCountPressed", "0");
    }

    function dislike() {
        if (localStorage.getItem("dislikeCountPressed") === "1") {
            unDislike()
        } else {
            var firebasePost = firebase.database().ref('posts/10');
            firebasePost.once('value').then((snapshot) => {
                const data = snapshot.val();

                if (data == null) {
                    firebasePost.set({
                        likeCount: 0,
                        dislikeCount: 0,
                        title: 'JavaScript - React - GraphQL - MongoDb',
                    });
                } else {
                    var obj = {};
                    obj["dislikeCount"] = data["dislikeCount"] + 1;

                    firebasePost.update(obj, function (error) {
                        if (error) {
                            console.error("Ooops! Something went wrong during like count update");
                        }
                    });
                    document.getElementById("dislikeCount").innerHTML = data["dislikeCount"] + 1;
                }
            });
            localStorage.setItem("dislikeCountPressed", "1");
        }
    }

    function unDislike() {
        var firebasePost = firebase.database().ref('posts/10');
        firebasePost.once('value').then((snapshot) => {
            const data = snapshot.val();

            if (data == null) {
                firebasePost.set({
                    likeCount: 0,
                    dislikeCount: 0,
                    title: 'JavaScript - React - GraphQL - MongoDb',
                });
            } else {
                var obj = {};
                obj["dislikeCount"] = data["dislikeCount"] - 1;

                firebasePost.update(obj, function(error) {
                    if (error) {
                        console.error("Ooops! Something went wrong during like count update");
                    }
                });
                document.getElementById("dislikeCount").innerHTML = data["dislikeCount"] - 1;
            }
        });
        localStorage.setItem("dislikeCountPressed", "0");
    }
</script>
<p>-------------------------------------</p>
<button type="button" class="btn btn-default" onclick="like()">Liked</button><span>  </span><span id="likeCount"></span>
<button type="button" class="btn btn-default" onclick="dislike()">Dislike</button><span>  </span><span id="dislikeCount"></span>



      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Pavel Susloparov Personal Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Pavel Susloparov Personal Blog</li><li><a class="u-email" href="mailto:contact@pavelsusloparov.com">contact@pavelsusloparov.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/PavelSusloparov"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">PavelSusloparov</span></a></li><li><a href="https://www.twitter.com/PSusloparov"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">PSusloparov</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Read about programming and software engineering processes</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
